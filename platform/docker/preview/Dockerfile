FROM kindest/node:v1.31.0

# 1. Setup the preload directory
RUN mkdir -p /var/lib/zerotouch

# 2. Copy the systemd logic
COPY import-images.sh /usr/local/bin/import-images.sh
COPY import-images.service /etc/systemd/system/import-images.service

# 3. Enable the service
RUN chmod +x /usr/local/bin/import-images.sh && \
    systemctl enable import-images.service

# 4. Copy the heavy archive
# NOTE: This file is expected to be generated by the CI workflow BEFORE build
COPY platform-images.tar /var/lib/zerotouch/platform-images.tar

LABEL description="ZeroTouch Preview Node - Pre-cached with Systemd Import"
